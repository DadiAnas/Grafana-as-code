# Grafana Notification Policies Configuration - PREPROD Environment
# Uses Grafana's native export format for easy import/export
# Supports both 'org' (name) and 'orgId' (numeric) for organization reference

apiVersion: 1

policies:
  # Main Organization Policy
  - org: Main Organization
    receiver: email-preprod
    group_by:
      - alertname
      - team
    routes:
      # Critical severity goes to webhook
      - receiver: webhook-preprod
        object_matchers:
          - - severity
            - "="
            - critical
        continue: true
        group_wait: 10s
        group_interval: 1m
        repeat_interval: 1h
      # Platform team alerts
      - receiver: email-preprod
        object_matchers:
          - - team
            - "="
            - platform
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 2h
      # Backend team alerts
      - receiver: email-preprod
        object_matchers:
          - - team
            - "="
            - backend
        group_wait: 30s
        group_interval: 5m
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h

  # Platform Team Organization Policy
  - org: Platform Team
    receiver: platform-email-preprod
    group_by:
      - alertname
      - namespace
    routes:
      - receiver: platform-webhook-preprod
        object_matchers:
          - - severity
            - "="
            - critical
        continue: true
        group_wait: 10s
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h

  # Application Team Organization Policy
  - org: Application Team
    receiver: app-email-preprod
    group_by:
      - alertname
      - service
    routes:
      - receiver: app-webhook-preprod
        object_matchers:
          - - severity
            - "="
            - critical
        continue: true
        group_wait: 10s
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 4h
